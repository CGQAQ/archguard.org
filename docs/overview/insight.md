---
layout: default
parent: Overview
title: Insight
permalink: /overview/insight
nav_order: 2
---

# Insight（洞见）

洞见提供的是一种架构自治服务。 它是一种面向架构分析领域的数据自助服务。它提供了一种集成一体的数据分析方案，让开发人员、架构师、管理者等可以根据不同任务，自由搭配、组合出适用于自身洞察需求的任务/函数。

```
field:dep_name == /.*dubbo/
|      |       |         |
|      |       |         |
|      |       |         |
└─分割符└─字段   └─ 比较符  └─ 值 
```

- 分隔符。即 `field:` 作为分隔符，方便于解析和后期扩展。
- 字段。对应于数据库中的表。
- 比较符。即：`==`、`>`、`<`、`>=`、`<=`、`!=`。
- 值。以 `'`、`"` 在始尾表示字符串，`/` 在始尾表示为正则，`%` 在始尾表示为模糊匹配。
   - 字符串。`'xxx'`、`"xxx"` 的形式，即视为字符串。
   - 正则（不推荐）。`/xxx/` 的形式，即视为正则。
   - 模糊匹配（**建议**）。`%xxx%` 的形式，即视为模糊匹配。
      - 如果字符串以 `%` 开始或结束，也视为模糊匹配，示例：'xxx%'、'%xxx'。

重点：出于性能原因，不建议采用正则表达式，建议采用**模糊匹配**的方式。模糊匹配采用的是数据库自带的 `LIKE` 方式进行的，而正则表达式则是在查询后过滤的。

主要的两种模式：

- 查询后过滤（filter after query, PostFilter）
- 查询中过滤（filter in query, PreFilter）

## 查询示例

**sca**，支持 `dep_name` 和 `dep_version` 的查询：

- dep_name：查询某个模块的所有版本。
- dep_version：查询某个版本号，并可进行比较。

## 如何实现？

### 表达式转换

**解析字符串成模型**（详细见：FieldFilter.kt)

1. 通过 `field:` 作为分隔符，将字段名和字段值分隔开，取出其中的字段值和表达式，如：`dep_name == /.*dubbo/`，`dep_version > 1.12.3`。
2. 解析字符串，并转换表达为三部分：
   1. 字段（filed）。为了方便设计，这里的 `dep_name` 对应于数据库中的字段。
   2. 比较（comparison）。比较的类型为 `==`、`>`、`<`、`>=`、`<=`、`!=`。
   3. 过滤（filter）条件。过滤的值类型为 `string`、`like`、`regex`。

**生成查询 SQL**（filter in query）

**执行查询后过滤**（filter after query）

### 判断

